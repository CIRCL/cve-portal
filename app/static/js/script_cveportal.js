// ADMIN USER MANAGEMENT PART //
$usertable = $('#usertable').bootstrapTable({
});

$('#get-selection').click(function () {
    $.ajax({
    type: "POST",
    contentType: "application/json; charset=utf-8",
    url: "/select",
    data: JSON.stringify($usertable.bootstrapTable('getSelections')),
    success: function(){
        location.reload();
    },
    dataType: "json"
    });
});


// USER NOTIFICATION MANAGEMENT //
$notiftable = $('notiftable').bootstrapTable({
});


var delay = (function(){
    var timer = 0;
    return function(callback, ms){
        clearTimeout(timer);
        timer = setTimeout(callback, ms)
    };
})();


$('#vendor-dropdown').on("click", "li.searchterm", function() {
    var value = $(this).text();
    $('#vendor').val(value);
});


$('#product-dropdown').on("click", "li.searchterm", function() {
    var value = $(this).text();
    $('#product').val(value);
});


$('#version-dropdown').on("click", "li.searchterm", function() {
    var value = $(this).text();
    $('#version').val(value);
});


$('#vendor').on("keyup click focusout", function () {
    delay(function(){
        $.ajax({
            type: "POST",
            contentType: "application/json; charset=utf-8",
            url: "/notifjson",
            dataType: "json",
            data: JSON.stringify(
                {"queryvendor":$('#vendor').val(),
                 "queryproduct":$('#product').val(),
                 "queryversion":$('#version').val()}),
            success: function(data){
                var vendors = data['vendors'];
                $('#vendor-dropdown').empty();
                for (var i = 0; i < vendors.length; i++){
                    $('#vendor-dropdown').append('<li class="searchterm"><a href="#">'+vendors[i]+'</a></li>');
                };
                if ($.inArray($('#vendor').val(), vendors) == 0){ //SUCCESS
                    $('#vendor').parent().toggleClass('has-warning', false);
                    $('#vendor').parent().toggleClass('has-success', true);
                } else {
                    $('#vendor').parent().toggleClass('has-success', false);
                    $('#vendor').parent().toggleClass('has-warning', true);
                    $('#vendorglyph').toggleClass('glyphicon-warning-sign', true);
                };
            },
        });
    }, 500 );
});


$('#product').on("keyup click focusout", function () {
delay(function(){
    $.ajax({
        type: "POST",
        contentType: "application/json; charset=utf-8",
        url: "/notifjson",
        dataType: "json",
        data: JSON.stringify(
            {"queryvendor":$('#vendor').val(),
             "queryproduct":$('#product').val(),
             "queryversion":$('#version').val()}),
        success: function(data){
            var products = data['products'];
            $('#product-dropdown').empty();
            for (var j = 0; j < products.length; j++){
                $('#product-dropdown').append('<li class="searchterm"><a href="#">'+products[j]+'</a></li>');
            };
            if ($.inArray($('#product').val(), products) == 0){
                $('#product').parent().toggleClass('has-warning', false);
                $('#product').parent().toggleClass('has-success', true);
            } else {
                $('#product').parent().toggleClass('has-success', false);
                $('#product').parent().toggleClass('has-warning', true);
            };
        },
    });
}, 500 );
});


$('#version').on("keyup click focusout", function () {
delay(function(){
    $.ajax({
        type: "POST",
        contentType: "application/json; charset=utf-8",
        url: "/notifjson",
        dataType: "json",
        data: JSON.stringify(
            {"queryvendor":$('#vendor').val(),
             "queryproduct":$('#product').val(),
             "queryversion":$('#version').val()}),
        success: function(data){
            var versions = data['versions'];
            $('#version-dropdown').empty();
            for (var j = 0; j < versions.length; j++){
                $('#version-dropdown').append('<li class="searchterm"><a href="#">'+versions[j]+'</a></li>');
            };
            if ($.inArray($('#version').val(), versions) == 0){
                $('#version').parent().toggleClass('has-warning', false);
                $('#version').parent().toggleClass('has-success', true);
            } else {
                $('#version').parent().toggleClass('has-success', false);
                $('#version').parent().toggleClass('has-warning', true);
            };
        },
    });
}, 500 );
});
